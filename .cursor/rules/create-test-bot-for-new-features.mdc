---
description: MANDATORY - Create test bot when adding new framework functionality
globs:
alwaysApply: true
---

# Create Test Bot for New Features

**MANDATORY REQUIREMENT:** When adding ANY new functionality to the framework, you MUST create a test bot to validate it. This is NOT optional.

## When You MUST Create a New Test Bot

**You are REQUIRED to create a test bot when adding:**

| New Feature | Action | Example |
|-------------|--------|---------|
| New TelegramMessage type | **CREATE** test bot | `TelegramReplyKeyboardMessage` → `reply_keyboard_bot.py` |
| New Event type | **CREATE** test bot | `ThresholdEvent` → `threshold_bot.py` |
| New Command type | **CREATE** test bot | `DialogCommand` → dedicated bot |
| New Dialog type | **CREATE** or extend `dialog_bot.py` | `PaginatedChoiceDialog` → `paginated_dialog_bot.py` |
| New factory function | **CREATE** test bot | `create_file_change_event` → `file_watcher_bot.py` |
| New utilities | **EXTEND** `utilities_bot.py` or **CREATE** new bot | formatting functions |

**DO NOT consider a feature complete until its test bot exists and compiles successfully.**

## Test Bot Requirements

1. **File location:** `test_bots/new_feature_bot.py`
2. **Credentials:** Read from `.token` and `.chat_id` files via `get_credentials()` pattern
3. **Imports:** Add parent directory to path for framework imports
4. **Documentation:** Update `test_bots/BOTS.md` with the new bot

## Template

```python
"""Description of what this bot tests.

Tests:
- Feature 1
- Feature 2
"""

import asyncio
import logging
import sys
from pathlib import Path

# Add grandparent directory to path for imports (to find my_bot_framework package)
sys.path.insert(0, str(Path(__file__).resolve().parent.parent.parent))

from my_bot_framework import BotApplication, ...


def get_credentials():
    """Get bot credentials from .token and .chat_id files in test_bots directory."""
    test_bots_dir = Path(__file__).resolve().parent
    token_file = test_bots_dir / ".token"
    chat_id_file = test_bots_dir / ".chat_id"
    
    if not token_file.exists() or not chat_id_file.exists():
        raise RuntimeError(
            "Missing credential files. Create .token and .chat_id files in test_bots directory."
        )
    
    token = token_file.read_text().strip()
    chat_id = chat_id_file.read_text().strip()
    
    if not token or not chat_id:
        raise RuntimeError(
            "Empty credential files. Ensure .token and .chat_id contain valid values."
        )
    return token, chat_id


def main():
    logging.basicConfig(level=logging.INFO)
    logger = logging.getLogger("new_feature_bot")
    
    token, chat_id = get_credentials()
    app = BotApplication.initialize(token=token, chat_id=chat_id, logger=logger)
    
    # Register your test events/commands here
    
    asyncio.run(app.run())


if __name__ == "__main__":
    main()
```
